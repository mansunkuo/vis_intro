{
    "contents" : "---\ntitle       : Interactive charts with googleVis in R\nsubtitle    : Tokyo R User Group, 17 April 2014\nauthor      : Markus Gesmann \njob         : Maintainer and co-author of googleVis\nframework   : io2012        # {io2012, html5slides, shower, dzslides, ...}\nhighlighter : highlight.js  # {highlight.js, prettify, highlight}\nhitheme     : tomorrow      # \nwidgets     : []            # {mathjax, quiz, bootstrap}\nmode        : selfcontained # {standalone, draft}\nlicense     : by-nc-sa\ngithub      :\n  user      : mages\n  repo      : googleVis_Tokyo_April_2014\n---\n\n<style>\n.title-slide {\n  background-color: #FFFFFF;\n}\n\n.title-slide hgroup > h1{\n font-family: 'Oswald', 'Helvetica', sanserif; \n}\n\n.title-slide hgroup > h1, \n.title-slide hgroup > h2 {\n  color: 535E43;  /* ; #EF5150*/\n}\n</style>\n\n\n## Disclaimer\n\n1. I am an autodidact\n2. What I present here works for me\n3. Read and follow the official [Google Chart API documentation](https://developers.google.com/chart/) and [Terms of Service](https://developers.google.com/readme/terms)\n4. Sometimes you have to re-load this presentation for the charts and all slides to appear\n\n---\n\n## Agenda\n\n* Introduction and motivation\n* Google Chart Tools\n* R package googleVis\n  * Concepts of googleVis\n  * Recent developments\n\n```{r setOptions, echo=FALSE, message=FALSE}\n#.libPaths(c(\"/home/gesmann/R/i686-pc-linux-gnu-library/3.1\", .libPaths())) \nlibrary(googleVis)\noptions(gvis.plot.tag=\"chart\")\nlibrary(xtable)\noptions(xtable.type = 'html')\n```\n\n\n--- .segue .dark\n\n## Introduction and motivation\n\n\n--- .class #id \n\n## Hello, I am Markus Gesmann\n\n* Manager of the Analysis team at [Lloyd's of London](http://www.lloyds.com)\n* Mathematican, [University of Cologne](http://www.mi.uni-koeln.de)\n* Maintainer and co-author of [ChainLadder](https://code.google.com/p/chainladder/) and [googleVis](http://github.com/mages/googleVis)\n* Founder and co-organiser of the [Cologne R user group](http://www.meetup.com/KoelnRUG) and [R in Insurance](http://www.rininsurance.com) conference\n* [Blogger](http://lamages.blogspot.com)\n\n---\n\n## I work here: Lloyd's of London\n\n![](assets/img/Exterior.jpg)\n\n---\n\n## The leading specialty insurance market\n\n![](assets/img/interior.jpg)\n\n--- .class #id \n\n## Hans Rosling: No more boring data\n\n<iframe width=\"420\" height=\"315\" src=\"http://www.youtube.com/embed/hVimVzgtD6w\" frameborder=\"0\" allowfullscreen></iframe>\n\n---\n\n## Motivation for googleVis\n\n* Inspired by Hans Rosling’s talks we wanted to use interactive data visualisation tools to foster the dialogue between data analysts and others\n* We wanted moving bubbles charts as well\n* The software behind Hans’ talk was bought by Google and integrated as motion charts into their Visualisation API\n* Ideally we wanted to use R, a language we knew\n* Hence, we had to create an interface between the Google Chart Tools and R\n\n--- .segue .dark\n\n## Google Chart Tools\n\n---\n\n## Introduction to Google Chart Tools\n\n* Google Chart Tools provide a way to visualize data on web sites\n* The API makes it easy to create interactive charts\n* It uses JavaScript and DataTable / JSON as input\n* Output is either HTML5/SVG or Flash\n* Browser with internet connection required to display chart\n* Please read the Google [Terms of Service](https://developers.google.com/terms/) before you start\n\n---\n\n## Structure of Google Charts\n\nThe chart code has five generic parts:\n\n1. References to Google's AJAX and Visualisation API\n2. Data to visualize as a DataTable\n3. Instance call to create the chart\n4. Method call to draw the chart including options\n5. HTML &lt;div&gt; element to add the chart to the page\n\n---\n\n## How hard can it be?\n\n* Transform data into JSON object \n* Wrap some HTML and JavaScript around it \n* Thus, googleVis started life in August 2010\n\n\n----\n\n## Motion chart example\n\n```{r motionchartcode, results='asis', tidy=FALSE}\nplot(gvisMotionChart(Fruits, \"Fruit\", \"Year\",\n                     options=list(width=600, height=400)))\n```\n\n--- .segue .dark\n\n## R package googleVis \n\n--- \n\n## Overview of googleVis\n\n* [googleVis](http://github.com/mages/googleVis) is a package for [R](http://www.r-poject.org/) and provides an interface between R and the [Google Chart Tools](https://developers.google.com/chart/)\n\n* The functions of the package allow users to visualize data with the Google Chart Tools without uploading their data to Google\n\n* The output of googleVis functions is html code that contains the data and references to JavaScript functions hosted by Google\n\n* To view the output a browser with an internet connection is required, the actual chart is rendered in the browser; some charts require Flash\n\n* See also: **Using the Google Visualisation API with R**, \n  [The R Journal, 3(2):40-44, December 2011](http://journal.r-project.org/archive/2011-2/RJournal_2011-2_Gesmann+de~Castillo.pdf) and googleVis [package vignette](http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis.pdf)\n\n---\n\n## googleVis version 0.5.1 provides interfaces to \n\n* Flash based\n  * Motion Charts\n  * Annotated Time Lines\n  * Geo Maps\n* HMTL5/SVG based\n  * Maps, Geo Charts and Intensity Maps,\n  * Tables, Gauges, Tree Maps, Timelines,\n  * Line-, Bar-, Column-, Area- and Combo Charts,\n  * Scatter-, Bubble-, Candlestick-, Pie- and Org Charts,\n  * Annotation-, Calendar-, Histogram and Sankey Charts\n* Support for roles and trendlines\n\nRun ```demo(googleVis)``` to see examples of all charts and read the [vignette](http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis.pdf) for more details.\n\n----\n\n## Key ideas of googleVis\n\n* Create wrapper functions in R which generate html files with references to Google's Chart Tools API\n* Transform R data frames into [JSON](http://www.json.org/) objects with [RJSONIO](http://www.omegahat.org/RJSONIO/)\n\n```{r}\nlibrary(RJSONIO)\ndat <- data.frame(x=LETTERS[1:2], y=1:2)\ncat(toJSON(dat)) \n```\n* Display the HTML output with the R HTTP help server\n\n---\n\n## The googleVis concept\n\n* Charts: *'gvis' + ChartType*\n* For a motion chart we have\n\n```{r eval=FALSE, tidy=FALSE}\nM <- gvisMotionChart(data, idvar='id', timevar='date', \n                     options=list(), chartid)\n```\n\n* Output of googleVis is a list of list\n\n* Display the chart by simply plotting the output: ```plot(M)```\n* Plot will generate a temporary html-file and open it in a new browser window \n* Specific parts can be extracted, e.g. \n  * the chart: ```M$html$chart``` or \n  * data: ```M$html$chart[\"jsData\"]```\n\n---\n\n## gvis-Chart structure\n\nList structure:\n\n<img height=350 src=\"https://dl.dropbox.com/u/7586336/googleVisExamples/gvisObject.png\" alt=\"gvis object structure\" />\n\n---\n\n## Scatter chart\n\n```{r results='asis', tidy=FALSE}\ndf <- data.frame(year=1:11, x=1:11)\nplot(gvisScatterChart(df,options=list(lineWidth=2)))\n```\n\n---\n\n## Add additional columns to define roles - NEW\n\n```{r results='asis', tidy=FALSE}\ndf <- data.frame(year=1:11, x=1:11,\n                 x.scope=c(rep(TRUE, 8), rep(FALSE, 3)),\n                 y=11:1, y.html.tooltip=LETTERS[11:1],                 \n                 y.certainty=c(rep(TRUE, 5), rep(FALSE, 6)),\n                 y.emphasis=c(rep(FALSE, 4), rep(TRUE, 7)))\nplot(gvisScatterChart(df,options=list(lineWidth=2)))\n```\n\n---\n\n## Line chart with options set\n\n```{r results='asis', tidy=FALSE}\ndf <- data.frame(label=c(\"US\", \"GB\", \"BR\"), val1=c(1,3,4), val2=c(23,12,32))\nLine <- gvisLineChart(df, xvar=\"label\", yvar=c(\"val1\",\"val2\"),\n        options=list(title=\"Hello World\", legend=\"bottom\",\n                titleTextStyle=\"{color:'red', fontSize:18}\",                         \n                vAxis=\"{gridlines:{color:'red', count:3}}\",\n                hAxis=\"{title:'My Label', titleTextStyle:{color:'blue'}}\",\n                series=\"[{color:'green', targetAxisIndex: 0}, \n                         {color: 'blue',targetAxisIndex:1}]\",\n                vAxes=\"[{title:'Value 1 (%)', format:'##,######%'}, \n                                  {title:'Value 2 (\\U00A3)'}]\",                          \n                curveType=\"function\", width=500, height=300                         \n                ))\n```\nOptions in googleVis have to follow the Google Chart API options\n\n---\n\n## Line chart with options\n```{r results='asis'}\nplot(Line)\n```\n\n---\n\n## Displaying geographical information\n\nPlot countries' S&P credit rating sourced from Wikipedia\n```{r tidy=FALSE}\nlibrary(XML)\nurl <- \"http://en.wikipedia.org/wiki/List_of_countries_by_credit_rating\"\nx <- readHTMLTable(readLines(url), which=3)\nlevels(x$Rating) <- substring(levels(x$Rating), 4, \n                            nchar(levels(x$Rating)))\nx$Ranking <- x$Rating\nlevels(x$Ranking) <- nlevels(x$Rating):1\nx$Ranking <- as.character(x$Ranking)\nx$Rating <- paste(x$Country, x$Rating, sep=\": \")\nG <- gvisGeoChart(x, \"Country\", \"Ranking\", hovervar=\"Rating\",\n                options=list(gvis.editor=\"S&P\",\n                             projection=\"kavrayskiy-vii\",\n                             colorAxis=\"{colors:['#91BFDB', '#FC8D59']}\"))\n```\n\n---\n\n## Chart countries' S&P credit rating\n\n```{r results='asis'}\nplot(G)\n```\n\n---\n\n## Geo chart with markers\nDisplay earth quakes in Japan of last 30 days\n```{r results='asis', tidy=FALSE}\nlibrary(XML)\neq <- read.csv(\"http://earthquake.usgs.gov/earthquakes/feed/v0.1/summary/2.5_week.csv\")\neq$loc=paste(eq$Latitude, eq$Longitude, sep=\":\")\n\nG <- gvisGeoChart(eq, \"loc\", \"Depth\", \"Magnitude\",\n                   options=list(displayMode=\"Markers\", \n                   colorAxis=\"{colors:['purple', 'red', 'orange', 'grey']}\", \n                   region=\"JP\",\n                   backgroundColor=\"lightblue\"))\n````\n\n---\n\n## Geo chart of earth quakes\n```{r results='asis', tidy=FALSE}\nplot(G)\n```\n\n---\n\n## Google Map - NEW individual markers\n```{r eval=FALSE, tidy=FALSE}\ndf <- data.frame(Adress=c(\"EC3M 7HA\", \"東京都新宿区北新宿2-21-1\"),\n                 Tip=c(\"Lloyd's\", \"Tokyo R User Group\"))\nplot(gvisMap(df, \"Adress\", \"Tip\",\n              options=list(mapType='normal',\n                icons=\"{'default': {'normal': 'http://icons.iconarchive.com/icons/icons-land/vista-map-markers/48/Map-Marker-Ball-Azure-icon.png',\n                                               'selected': 'http://icons.iconarchive.com/icons/icons-land/vista-map-markers/48/Map-Marker-Ball-Right-Azure-icon.png'}\n                                  }\", width=800, height=250)))\n```\n<iframe src=\"https://dl.dropboxusercontent.com/u/7586336/blogger/MapTokyoRUserGroup.html\" width=600 height=300 frameborder=0>Loading</iframe>\n---\n\n## Timeline - NEW\n```{r results='asis', tidy=FALSE}\ndat <- data.frame(Room=c(\"Room 1\",\"Room 2\",\"Room 3\"),\n                  Language=c(\"Japanese\", \"English\", \"German\"),\n                  start=as.POSIXct(c(\"2014-04-17 14:00\", \"2014-04-17 15:00\",\n                                     \"2014-04-17 14:30\")),\n                  end=as.POSIXct(c(\"2014-04-17 15:00\", \"2014-04-17 16:00\",\n                                   \"2014-04-17 15:30\")))\nplot(gvisTimeline(data=dat, rowlabel=\"Room\", barlabel=\"Language\",\n                  start=\"start\", end=\"end\", options=list(width=800, height=250)))\n```\n\n---\n\n## Sankey chart - NEW\n```{r results='asis', tidy=FALSE}\ndat <- data.frame(From=c(rep(\"A\",3), rep(\"B\", 3)), \n                  To=c(rep(c(\"X\", \"Y\", \"Z\"),2)),\n                  Weight=c(5,7,6,2,9,4))\nplot(gvisSankey(dat, from=\"From\", to=\"To\", weight=\"Weight\",\n                options=list(height=250)))\n```\n\n---\n\n## Calendar chart - NEW\n```{r eval=FALSE, tidy=FALSE}\nplot(gvisCalendar(Cairo, datevar=\"Date\",\n                  numvar=\"Temp\",\n                  options=list(calendar=\"{ cellSize: 10 }\"))\n```\n<iframe src=\"https://dl.dropboxusercontent.com/u/7586336/blogger/CalendarCario.html\" width=600 height=400>Loading</iframe>\n\n---\n\n## Annotation Chart - NEW\n\n```{r results='asis', tidy=FALSE, warning=FALSE}\nxtable(tail(Stock, 3))\nA <- gvisAnnotationChart(Stock, datevar=\"Date\",\n                         numvar=\"Value\", idvar=\"Device\",\n                         titlevar=\"Title\", annotationvar=\"Annotation\",\n                         options=list(displayAnnotations=TRUE,\n                                      legendPosition='newRow',\n                                      width=600, height=300)\n                         )\n```\n\n---\n\n## Annotation Chart - NEW\n\n```{r eval=FALSE, tidy=FALSE}\nplot(A, tag='chart')\n```\n<iframe src=\"https://dl.dropboxusercontent.com/u/7586336/blogger/AnnotationChart.html\" frameborder=\"0\" width=\"600\" height=\"400\">Loading</iframe>\n\n---\n\n## Merging gvis-objects\n\n```{r results='asis', tidy=FALSE}\nG <- gvisGeoChart(Exports, \"Country\", \"Profit\", \n                  options=list(width=250, height=120))\nB <- gvisBarChart(Exports[,1:2], yvar=\"Profit\", xvar=\"Country\",                  \n                  options=list(width=250, height=260, legend='none'))\nM <- gvisMotionChart(Fruits, \"Fruit\", \"Year\",\n                     options=list(width=400, height=380))\nGBM <- gvisMerge(gvisMerge(G,B, horizontal=FALSE), \n                 M, horizontal=TRUE, tableOptions=\"cellspacing=5\")\n```\n\n---\n\n## Display merged gvis-objects\n```{r merged, results='asis', eval=FALSE}\nplot(GBM)\n```\n<iframe src=\"https://dl.dropboxusercontent.com/u/7586336/googleVisExamples/gvisMergeExample.html\" frameborder=\"0\", width=\"620\", height=\"420\">Loading</iframe>\n\n---\n\n## Embedding googleVis chart into your web page\n\nSuppose you have an existing web page and would like to integrate the output of a googleVis function, such as ```gvisMotionChart```.\n\nIn this case you only need the chart output from ```gvisMotionChart```. So you can either copy and paste the output from the R console\n\n```{r eval=FALSE}\n print(M, 'chart') #### or cat(M$html$chart)\n```\ninto your existing html page, or write the content directly into a file\n\n```{r eval=FALSE}\nprint(M, 'chart', file='myfilename')\n```\nand process it from there.\n\n---\n\n## Embedding googleVis output via iframe\n\n* Embedding googleVis charts is often easiest done via the iframe tag:\n* Host the googleVis output on-line, e.g. public Dropbox folder\n* Use the iframe tag on your page:\n\n```\n<iframe width=620 height=300 frameborder=\"0\"\nsrc=\"http://dl.dropbox.com/u/7586336/RSS2012/line.html\">\nYour browser does not support iframe\n</iframe>\n```\n\n---\n\n## iFrame output\n\n<iframe width=620 height=300 frameborder=\"0\" src=\"http://dl.dropbox.com/u/7586336/RSS2012/line.html\">You browser does not support iframe</iframe>\n\n---\n\n## Including googleVis output in knitr with plot statement\n\n* With version 0.3.2 of googleVis `plot.gvis` gained the argument `'tag'`, which works similar to the argument of the same name in `print.gvis`. \n\n* By default the tag argument is `NULL` and `plot.gvis` has the same behaviour as in the previous versions of googleVis. \n\n* Change the tag to `'chart'` and `plot.gvis` will produce the same output as `print.gvis`. \n\n* Thus, setting the `gvis.plot.tag` value to `'chart'` in `options()` will return the HTML code of the chart when the file is parsed with `knitr`. \n\n* See the example in `?plot.gvis` for more details\n\n---\n\n## Further reading and examples\n\n* [Shiny by RStudio](http://www.rstudio.com/shiny/)\n* [First steps with googleVis on shiny](http://lamages.blogspot.co.uk/2013/02/first-steps-of-using-googlevis-on-shiny.html)\n* [RStudio Glimmer Server](http://glimmer.rstudio.com:8787)\n* [BI Dashbord with shiny and rCharts](http://glimmer.rstudio.com/reinholdsson/shiny-dashboard/)\n* [Shiny examples with slidify](https://github.com/ramnathv/shinyExamples)\n* [Shiny on R-Bloggers](http://www.r-bloggers.com/?s=shiny)\n\n\n--- .segue .dark\n\n## The End. Questions? \n\n----\n\n## How I created these slides\n\n```{r slidify, eval=FALSE}\nlibrary(slidify)\nauthor(\"googleVis_Tokyo_April_2014\")\n## Edit the file index.Rmd file and then\nslidify(\"index.Rmd\")\n```\n\n---\n\n## Other R packages\n\n* [rCharts](http://ramnathv.github.io/rCharts/)\n* [clickme](https://github.com/nachocab/clickme)\n* [R animation package allows to create SWF, GIF and MPEG directly](http://animation.yihui.name/)\n* [iplots: iPlots - interactive graphics for R](http://cran.r-project.org/web/packages/iplots/)\n* [Acinonyx aka iPlots eXtreme](http://rforge.net/Acinonyx/index.html)\n* [gridSVG: Export grid graphics as SVG](http://cran.r-project.org/web/packages/gridSVG/index.html)\n* [plotGoogleMaps: Plot HTML output with Google Maps API and your own data](http://cran.r-project.org/web/packages/plotGoogleMaps/)\n* [RgoogleMaps: Overlays on Google map tiles in R](http://cran.r-project.org/web/packages/RgoogleMaps/index.html)\n\n---\n\n## Thanks\n\n* Google, who make the visualisation API available\n* All the guys behind www.gapminder.org and Hans Rosling for telling\n    everyone that data is not boring \n* Sebastian Perez Saaibi for his inspiring talk on 'Generator\n    Tool for Google Motion Charts' at the R/RMETRICS conference 2010\n* Henrik Bengtsson for providing the 'R.rsp: R Server Pages'\n    package and his reviews and comments\n* Duncan Temple Lang for providing the 'RJSONIO' package\n* Deepayan Sarkar for showing us in the lattice package how to deal\n    with lists of options  \n* Paul Cleary for a bug report on the handling of months:\n    Google date objects expect the months Jan.- Dec. as 0 - 11 and\n    not 1 - 12.\n* Ben Bolker for comments on plot.gvis and the usage of temporary\n    files  \n\n\n---\n\n## Thanks \n\n* John Verzani for pointing out how to use the R http help server\n* Cornelius Puschmann and Jeffrey Breen for highlighting a\n    dependency issue with RJONSIO version 0.7-1\n* Manoj Ananthapadmanabhan and Anand Ramalingam for providing\n    ideas and code to animate a Google Geo Map\n* Rahul Premraj for pointing out a rounding issue with Google Maps \n* Mike Silberbauer for an example showing how to shade the\n    areas in annotated time line charts\n* Tony Breyal for providing instructions on changing the Flash\n    security settings to display Flash charts locally \n* Alexander Holcroft for reporting a bug in gvisMotionChart\n    when displaying data with special characters in column names\n* Pat Burns for pointing out typos in the vignette\n\n---\n\n## Thanks\n\n* Jason Pickering for providing a patch to allow for quarterly \n    and weekly time dimensions to be displayed with gvisMotionChart\n* Oliver Jay and Wai Tung Ho for reporting an issue with one-row \n    data sets\n* Erik Bülow for pointing out how to load the Google API via a\n    secure connection\n* Sebastian Kranz for comments to enhance the argument list for\n    gvisMotionChart to make it more user friendly \n* Sebastian Kranz and Wei Luo for providing ideas and code to\n    improve the transformation of R data frames into JSON code\n* Sebastian Kranz for reporting a bug in version 0.3.0\n* Leonardo Trabuco for helping to clarify the usage of the\n    argument state in the help file of gvisMotionChart\n* Mark Melling for reporting an issue with jsDisplayChart and\n    providing a solution\n\n---\n\n## Thanks\n\n* Joe Cheng for code contribution to make googleVis work with shiny\n* John Maindonald for reporting that the WorldBank demo didn't \n    download all data, but only the first 12000 records.\n* Sebastian Campbell for reporting a typo in the Andrew and Stock\n    data set and pointing out that the core charts, such as line\n  charts accept also date variables for the x-axis. \n* John Maindonald for providing a simplified version of the\n    WorldBank demo using the WDI package.\n* John Muschelli for suggesting to add 'hovervar' as an additional\n    argument to gvisGeoChart.\n* Jacqueline Buros for providing code to include formats parameter \n    to gvisTable()\n* JJ Allaire for pointing out how to use the viewer pane in RStudio\n  o Oliver Gjoneski and Ashton Trey Belew for patches on roles and tooltips\n* [Ramnath Vaidyanathan](https://github.com/ramnathv) for slidify.\n\n---\n## Session Info\n\n```{r sessionInfo3}\nsessionInfo()\n```\n",
    "created" : 1411679351553.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "971407221",
    "id" : "A35BF256",
    "lastKnownWriteTime" : 1397629738,
    "path" : "~/Documents/Projects/mages-googleVis_Tokyo_April_2014-f7c4504/index.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}