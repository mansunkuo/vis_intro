{
    "contents" : "---\ntitle: \"Interactive Visualization with R\"\nauthor: \"[Mansun Kuo](https://www.linkedin.com/pub/mansun-kuo/82/3b4/344)\"\ndate: '`r Sys.Date()`<br><br><a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-sa/4.0/\"><img alt=\"creativecommons\" style=\"border-width:0\" src=\"images/by-nc-sa-4.0-88x31.png\" /></a>'\noutput:\n  ioslides_presentation:\n  #slidy_presentation:\n    css: css/ioslides.css\n    #logo: assets/img/Taiwan-R-logo.png\n    widescreen: yes\nsubtitle: googleVis and shiny\n---\n\n\n\n# 前言\n```{r Preface}\n```\n\n\n## 有位教授曾經這樣說 {.flexbox .vcenter .emphasized}\n\n你們統計所畢業的人做的工作都很奇特\n\n\n## About Me\n\n```{r include=FALSE}\nsource(\"source/get_timeline.R\", local = TRUE)\n```\n\n<iframe src=\"charts/timeline.html\"></iframe>\n\n\n## 工作上常常遇到的狀況\n\n<iframe width=\"960\" height=\"720\" src=\"//www.youtube.com/embed/MNFcBXaVIx8?rel=0&amp;controls=0\" frameborder=\"0\" allowfullscreen></iframe>\n\n<div class=\"notes\">\nI have no idea what you're talking about...\n</div>\n\n\n## [Elaboration Likelihood Model](http://en.wikipedia.org/wiki/Elaboration_likelihood_model)\n\n個人由於「動機」以及「能力」的不同，對於資訊會有不同的處理方式。\n\n- 中心途徑(central route)\n\n    個人具有高度的動機和能力時，會考慮和推敲勸說情況中的各個方面，以決定是否改變對事物的態度。\n\n- 外圍途徑(peripheral route)\n\n    個人之動機與能力相對較弱時，更容易被表觀特徵所說服。\n\n\n## {.flexbox .vcenter .emphasized}\n\n讓資料看起來美觀甚至是有趣還是很重要\n\n\n## {.flexbox .vcenter .emphasized}\n\n<span>今天談談怎麼使用R做出動來動去  \n<span style=\"text-decoration: line-through;\">但用途不明</span>的圖表</span>\n\n\n# googleVis\n\n## googleVis\n\nWhat:\n\n- 一個讓資料科學家能快速產出互動圖表之方便工具\n- 使用者可在R中使用[Google Chart Tools](https://developers.google.com/chart/)\n- 輸出html程式碼，中間亦會鑲嵌對應之javascript或flash\n- [圖形範例](http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis_examples.html)\n\nWhy:\n\n- 歷史悠久(2010~)\n- 在CRAN即可下載\n- 能完成大部分基本的統計圖表\n\n\n## 應用方式\n\n- localhost\n\n    使用plot.gvis()在localhost產出圖形\n\n- knitr\n\n    chunk option: results='asis'\n    - print.gvis(foo, \"chart\")\n    - 存為獨立的檔案再使用iframe載入\n\n- shiny\n\n    使用renderGvis()在shiny中產生圖形\n  \n\n## 注意事項\n\n- 需要網路連線才能使用\n- 所有圖形之輸入資料皆為data.frame\n- options參數以List型態輸入，中間可能包括json物件\n- Motion、Annotated Time Lines和Geo Maps需要Flash\n- 在本地資料夾使用motion chart需設定flash安全安全性\n- html slides相容性\n\n\n## 讀取googleVis\n\n```{r}\nlibrary(googleVis)\n```\n\n\n## 臺北旅遊網-景點資料\n\n使用jsonlite可以很輕鬆地把json array讀為data frame\n\n- 資料來源\n  [臺北旅遊網-景點資料(中文)](http://data.taipei.gov.tw/opendata/apply/query/MzVERDUyOTItNjI1NC00NjcyLUE3OEItNDY3ODhDMURFM0Yy?$format=json)\n\n\n```{r message=FALSE, cache=FALSE}\nlibrary(jsonlite)\ntravel_file = \"data/data.json\"\n# fileurl = \"http://data.taipei.gov.tw/opendata/apply/query/MzVERDUyOTItNjI1NC00NjcyLUE3OEItNDY3ODhDMURFM0Yy?$format=json\"\n# download.file(fileurl, destfile=travel_file)\ntravel_json = readLines(travel_file, warn=FALSE, encoding=\"UTF-8\")\ntravel_data = fromJSON(travel_json, simplifyVector = TRUE)\n```\n\n\n## {.smaller}\n\n```{r echo=TRUE}\nstr(travel_data)\n```\n\n\n## 經緯度和超連結\n\n從原始資料中組合出經緯度與超連結的格式供googleVis使用\n\n```{r}\ntravel_data$LatLon = paste(travel_data$latitude, travel_data$longitude, sep=\":\")\ntravel_data$LatLon[1]\n```\n\n```{r }\ntravel_data$tips = paste(\"<a href='\",\n                         travel_data$xurl,\n                         \"'>\",\n                         travel_data$stitle, \n                         \"</a>\",\n                         sep=\"\")\ntravel_data$tips[1]\n```\n\n\n## gvisTable\n\n```{r results='asis'}\ngvisdata = data.frame(travel_data[, c(\"tips\", \"memo_tel\", \"LatLon\", \n                                      \"address\", \"mrt\")])\nTable = gvisTable(gvisdata, options=list(page=\"enable\"))\nprint(Table, \"chart\")\n```\n\n\n## gvisMap\n\n將景點資訊以超連結標示在地圖上，先儲存為獨立的html檔再使用iframe讀進來。\n\n```{r}\nMap = gvisMap(travel_data, \"LatLon\", \"tips\",\n              options=list(showTip=TRUE, \n                           enableScrollWheel=T,\n#                            width=750, height=500,\n                           useMapTypeControl=T,\n                           mapType='normal'\n                           )\n              )\ncat(Map$html$header, Map$html$chart, Map$html$footer, \n    sep = \"\\n\", file=\"charts/Map.html\")\n```\n\n```html\n<iframe src=\"charts/Map.html\"></iframe>\n```\n\n##\n\n<iframe src=\"charts/Map.html\"></iframe>\n\n\n## gvisBar\n\n將捷運站附近有超過五個景點之挑出來以長條圖呈現。\n\n```{r}\nmrt = table(travel_data$mrt)\ngvisdata = data.frame(mrt)\ngvisdata = gvisdata[order(gvisdata[, 2], decreasing=T), ]\ngvisdata[which(gvisdata[,1] == \"\"), ] = NA\nBar = gvisBarChart(gvisdata[which(gvisdata[,2]>5),],\n                   options=list(width=980, height=500,\n                                hAxis=\"{'minValue': 0}\"\n                                )\n                   )\n```\n\n##\n\n```{r results='asis'}\nprint(Bar, \"chart\") \n```\n\n\n## gvisHistogram & gvisMerge\n\n畫出經、緯度的直方圖並將兩張圖合併起來。\n\n```{r}\nhist_lat = gvisHistogram(data.frame(lat = as.numeric(travel_data$latitude)),\n                         options = list(vAxis = \"{'title': 'Latitude'}\",\n                                        hAxis = \"{'title': 'Frequency'}\",\n                                        legend = \"{'position': 'none'}\",\n                                        histogram = \"{'hideBucketItems': 'true'}\",\n                                        orientation = \"vertical\",\n                                        width = 500, height = 500))\nhist_lon = gvisHistogram(data.frame(lon = as.numeric(travel_data$longitude)),\n                         options = list(vAxis = \"{'title': 'Frequency'}\",\n                                        hAxis = \"{'title': 'Longitude', \n                                                  'slantedText': 'true'}\",\n                                        legend = \"{'position': 'none'}\",\n                                        histogram = \"{'hideBucketItems': 'true'}\",\n                                        width = 500, height = 500))\nhist_latlon = gvisMerge(hist_lat, hist_lon, horizontal = TRUE)\n```\n\n\n## \n\n```{r results='asis'}\nprint(hist_latlon, \"chart\")\n```\n\n\n## 薪資及生產力統計資料\n\n\n這裡我們使用\n[薪資及生產力統計資料查詢系統](http://win.dgbas.gov.tw/dgbas04/bc5/EarningAndProductivity/Default.aspx)\n之資料來示範Motion Chart。\n\n\n```{r message=FALSE}\nworker_data = read.csv(\"data/worker_data.csv\", stringsAsFactors=F)\n\ncolnames(worker_data) = gsub(\"\\\\.\", \"\", colnames(worker_data))\nworker_data[worker_data == \"-\"] = NA\nindex = which(colnames(worker_data) != \"行業\")\nfor(i in index){\n    worker_data[, i] = as.numeric(worker_data[, i])\n}\nworker_data$時間年 = worker_data$時間年 + 1911\nworker_data$平均時薪 = worker_data$平均薪資/worker_data$平均工時\n```\n\n---\n\n```{r}\nstr(worker_data)\n```\n\n\n## Motion Chart\n\n```{r results='asis'}\nMotion = gvisMotionChart(worker_data, \n                         idvar=\"行業\", \n                         timevar=\"時間年\",\n                         xvar=\"受僱員工人數\",\n                         yvar=\"平均時薪\")\n```\n\n---\n\n```{r results='asis'}\n# plot(Motion)\nprint(Motion, \"chart\")\n```\n\n\n\n# 其他相關套件\n\n\n## [rCharts](http://rcharts.io/#)\n\n- 集結了目前時下最熱門的Javascript圖形套件\n- 目前還沒放上CRAN，需從github安裝：\n```r\nrequire(devtools)\ninstall_github('rCharts', 'ramnathv')\n```\n- 文件相對來說較為不完整，若要做細部調整需略懂Javascript較容易上手\n- [圖形範例](http://rcharts.io/gallery/)\n\n\n## NVD3 Example\n\n\n```{r results='asis'}\nhair_eye_male <- subset(as.data.frame(HairEyeColor), Sex == 'Male')\nlibrary(rCharts)\nn1 <- nPlot(Freq ~ Hair, group = 'Eye', data = hair_eye_male, type = 'multiBarChart')\nn1$show('inline', include_assets = TRUE, cdn = TRUE)\n```\n\n\n## Timeline Example - Code\n\n<div class=\"code_block\">\n\nget_timeline.R:\n\n```{r results='asis', echo=FALSE}\ncatfile = \"source/get_timeline.R\"\ncat(\"```r\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\nLoad with iframe:\n\n```html\n<iframe src=\"charts/timeline.html\"></iframe>\n```\n\n</div>\n\n\n## Timeline Example - YAML file\n\n\n<div class=\"code_block\">\n\n```{r results='asis', echo=FALSE}\ncatfile = \"data/history.yaml\"\ncat(\"```yaml\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\n</div>\n\n\n## ggvis\n\n\n\n## \n\n```{r message=FALSE, echo=TRUE}\nlibrary(knitr)\nlibrary(ggvis)\nout = mtcars %>%\n    ggvis(x = ~wt, y = ~mpg) %>%\n    layer_smooths(se=TRUE, opacity := 0.5, opacity.hover := 0.75) %>% \n    layer_points(fill = ~factor(cyl), size := 50, size.hover := 200) %>%\n    set_options(hover_duration = 250) \n```\n\n```{r message=FALSE, echo=FALSE, fig.height=2.5}\nout\n```\n\n\n# Shiny\n\n## Shiny\n\n- R語言中目前最熱門的網頁應用程式框架\n- 不需具備Javascript之知識亦可輕鬆開發互動式網頁應用\n- 基本架構：\n    - server.R\n        負責後端資料處理與運算\n    - ui.R\n        負責前端使用者界面的呈現\n    - global.R(optional)\n        放置ui和server共用的設定\n\n\n## Basic server.R\n\n\n```{r results='asis', echo=FALSE}\ncatfile = \"apps/cheatsheet/server.R\"\ncat(\"```r\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\n\n\n## Basic ui.R\n\n<div class=\"code_block\">\n\n```{r results='asis', echo=FALSE}\ncatfile = \"apps/cheatsheet/ui.R\"\ncat(\"```r\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\n</div>\n\n\n## Reactivity\n\n當輸入改變時，server會重新執行和該輸入有相依性的程式碼\n\n- render*\n- reactive\n- isolate\n- observe\n\n\n## render*\n\n當UI中的a改變時，會重新執行該段程式碼並產生z\n\n```r\noutput$z <- renderText({\n    input$a \n})\n```\n\n<img src=\"images/render.png\" height=\"100\">\n\n\n## reactive\n\n當UI中的a改變時，會重新產生x，x的結果可以在多個output使用\n\n```r\nx <- reactive({\n    input$a\n})\noutput$z <- renderText({\n    x()\n})\noutput$z <- renderText({\n    x()\n})\n```\n\n<img src=\"images/reactive.png\" height=\"100\">\n\n## isolate\n\n當UI中的a改變時，不會重新執行這段程式，僅有在b改變的時候才會重新執行並產生z\n\n```r\noutput$z <- renderText({\n    paste(\n        isolate(input$a),\n        input$b \n    )\n)\n```\n\n<img src=\"images/isolate.png\" height=\"100\">\n\n## observe\n\n當UI中的a改變時，不會重新執行這段程式，但不會產生新的物件\n\n```r\nobserve({ \n    input$a\n    # code to run\n})\n```\n\n<img src=\"images/observe.png\" height=\"100\">\n\n## 薪資及生產力統計資料範例\n\n<!--iframe src=\"http://spark.rstudio.com/mansunkuo/googleVis_shiny/\"></iframe-->\n<iframe src=\"https://mansunkuo.shinyapps.io/googleVis_shiny/\"></iframe>\n\n\n\n## server.R\n\n<div class=\"code_block\">\n\n```{r results='asis', echo=FALSE}\ncatfile = \"apps/googleVis_shiny/server.R\"\ncat(\"```r\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\n</div>\n\n\n## ui.R\n\n<div class=\"code_block\">\n\n```{r results='asis', echo=FALSE}\ncatfile = \"apps/googleVis_shiny/ui.R\"\ncat(\"```r\",\n    readChar(catfile, nchars = file.info(catfile)$size),\n    \"```\",\n    sep = \"\\n\"\n    )\n```\n\n</div>\n\n\n## Share Your App\n\n- [ShinyApps.io](https://www.shinyapps.io/)\n\n- [Shiny Server](http://www.rstudio.com/products/shiny/shiny-server/)\n\n    - 預設Shiny Server會位於/srv/shiny-server\n\n\n## Hosting Model\n\n假設Shiny Server的URL是http://server.com/shiny/\n\n<div class=\"columns-2\">\n\n- /srv/shiny-server\n    - shinyApp1\n        - server.R\n        - ui.R\n    - shinyApp2\n        - server.R\n        - ui.R\n    - assets\n        - style.css\n        - script.js\n\n\nURL                                       | Definition\n------------------------------------------|---------------------------------\nhttp://server.com/shiny/shinyApp1         | Serve the Shiny App 'shinyApp1'\nhttp://server.com/shiny/shinyApp2         | Serve the Shiny App 'shinyApp2'\nhttp://server.com/shiny/assets/style.css  | Serve this static CSS file\nhttp://server.com/shiny/assets/script.js  | Serve this static JS file\n\n\n\n\n</div>\n\n## Reverse Proxy\n\n安裝Shiny Server後可設定reverse proxy，細節可參考\n[我的安裝流程](shiny_server_deployment.html)\n\n/etc/apache2/httpd.conf:\n\n```html\n<VirtualHost *:80>\n  <Proxy *>\n    Allow from localhost\n  </Proxy>\n  \n  ProxyPass        /rstudio/ http://localhost:8787/\n  ProxyPassReverse /rstudio/ http://localhost:8787/\n  RedirectMatch permanent ^/rstudio$ /rstudio/\n  \n  ProxyPass        /shiny/ http://localhost:3838/\n  ProxyPassReverse /shiny/ http://localhost:3838/\n  RedirectMatch permanent ^/shiny$ /shiny/\n</VirtualHost>\n```\n\n## 參考資料\n\ngoogleVis:\n\n- [Interactive charts with googleVis in R](http://mages.github.io/googleVis_Tokyo_April_2014/#1)\n- [Using the Google Chart Tools with R](http://cran.r-project.org/web/packages/googleVis/vignettes/googleVis.pdf)\n- [Hans Rosling 以新的視角解讀當今世界的貧困問題](http://www.ted.com/talks/lang/zh-tw/hans_rosling_reveals_new_insights_on_poverty.html)\n\n\nShiny:\n\n- [Shiny](http://shiny.rstudio.com/)\n- [The Shiny Cheat sheet](http://shiny.rstudio.com/articles/cheatsheet.html)\n- [Shiny Server](http://www.rstudio.com/products/shiny/shiny-server/)\n- [The Administrator's Guide to Shiny Server](http://rstudio.github.io/shiny-server/latest/)\n\n\n##\n\nrCharts & ggvis:\n\n- [Interactive Visualization - rCharts, UseR 2014](http://ramnathv.github.io/user2014-rcharts/#1)\n- [rCharts](http://rcharts.io/#)\n- [rCharts with knitr](https://github.com/ramnathv/rCharts/issues/373)\n- [ggvis](http://ggvis.rstudio.com/)\n\nOthers:\n\n- [An Introduction to R Markdown](https://rpubs.com/mansun_kuo/24330)\n\n",
    "created" : 1412199077756.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1402008035",
    "id" : "E5BFBA41",
    "lastKnownWriteTime" : 1412717241,
    "path" : "~/Dropbox/Public/demo/vis_intro/index.Rmd",
    "project_path" : "index.Rmd",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}